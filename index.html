<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§‡ßÅ‡¶® ‡¶®‡¶¨‡ßÄ Ô∑∫ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #d1fae5 0%, #99f6e4 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            padding: 40px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #065f46;
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #6b7280;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .info-box {
            background: #d1fae5;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            color: #065f46;
            margin-bottom: 15px;
        }
        
        .info-box ul {
            list-style: none;
            padding: 0;
        }
        
        .info-box li {
            color: #374151;
            margin: 10px 0;
            padding-left: 25px;
        }
        
        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        .auto-save-indicator.error {
            background: #ef4444;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #374151;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
        }
        
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #d1d5db;
            color: #374151;
            padding: 12px 24px;
            width: auto;
        }
        
        .btn-secondary:hover {
            background: #9ca3af;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }
        
        .btn-success {
            background: #059669;
            color: white;
        }
        
        .btn-success:hover {
            background: #047857;
        }
        
        .timer-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .timer {
            color: #ef4444;
            font-size: 24px;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }
        
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .question-badge {
            display: inline-block;
            background: #d1fae5;
            color: #065f46;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .question-text {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 20px;
        }
        
        .option {
            width: 100%;
            padding: 18px;
            margin: 10px 0;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            background: white;
            text-align: right;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .option:hover {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .option.selected {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        
        .nav-buttons button {
            flex: 1;
        }
        
        .success-icon {
            text-align: center;
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .success-message {
            text-align: center;
        }
        
        .success-message h2 {
            color: #065f46;
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .success-message p {
            color: #6b7280;
            font-size: 18px;
            margin: 10px 0;
        }
        
        .admin-link {
            text-align: center;
            margin-top: 30px;
        }
        
        .admin-link button {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .admin-link button:hover {
            color: #374151;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .export-buttons button {
            flex: 1;
            min-width: 150px;
        }
        
        .sync-status {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #065f46;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        thead {
            background: #10b981;
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: center;
        }
        
        th {
            font-weight: bold;
        }
        
        tbody tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .badge-green {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-red {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-gray {
            background: #f3f4f6;
            color: #374151;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .hidden {
            display: none;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .card {
                padding: 20px;
                border-radius: 15px;
            }
            
            .timer {
                font-size: 18px;
            }
            
            .timer-box {
                padding: 15px;
            }
            
            .question-card {
                padding: 20px;
            }
            
            .question-text {
                font-size: 18px;
            }
            
            .option {
                padding: 15px;
                font-size: 15px;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .nav-buttons button {
                width: 100%;
            }
            
            .auto-save-indicator {
                top: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-buttons button {
                width: 100%;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 4px;
            }
            
            .container {
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            .info-box {
                padding: 15px;
            }
            
            .info-box li {
                font-size: 14px;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .btn {
                padding: 15px;
                font-size: 16px;
            }
            
            .success-icon {
                font-size: 60px;
            }
            
            .success-message h2 {
                font-size: 24px;
            }
            
            .success-message p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="autoSaveIndicator" class="auto-save-indicator">‚úì ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§</div>
    <div id="app"></div>

    <script>
        // ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶°‡¶æ‡¶ü‡¶æ
        const QUESTIONS = [
            {
                id: 1,
                type: 'mcq',
                question: '‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶≤‡ßá ‡¶ú‡¶®‡ßç‡¶Æ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßá‡¶®?',
                options: ['‡ß´‡ß≠‡ß¶ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶¨‡ßç‡¶¶', '‡ß´‡ß¨‡ß¶ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶¨‡ßç‡¶¶', '‡ß´‡ßÆ‡ß¶ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶¨‡ßç‡¶¶', '‡ß´‡ßØ‡ß¶ ‡¶ñ‡ßç‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶¨‡ßç‡¶¶'],
                correctAnswer: 0
            },
            {
                id: 2,
                type: 'mcq',
                question: '‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?',
                options: ['‡¶Ü‡¶¨‡ßÅ ‡¶§‡¶æ‡¶≤‡¶ø‡¶¨', '‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π', '‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶≤ ‡¶Æ‡ßÅ‡¶§‡ßç‡¶§‡¶æ‡¶≤‡¶ø‡¶¨', '‡¶Ü‡¶¨‡ßÅ ‡¶¨‡¶ï‡¶∞'],
                correctAnswer: 1
            },
            {
                id: 3,
                type: 'mcq',
                question: '‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶¶‡ßÅ‡¶ß ‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?',
                options: ['‡¶Ü‡¶Æ‡¶ø‡¶®‡¶æ', '‡¶π‡¶æ‡¶≤‡¶ø‡¶Æ‡¶æ', '‡¶ñ‡¶æ‡¶¶‡¶ø‡¶ú‡¶æ', '‡¶Ü‡¶Ø‡¶º‡¶ø‡¶∂‡¶æ'],
                correctAnswer: 1
            },
            {
                id: 4,
                type: 'mcq',
                question: '‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡ßã‡¶® ‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßá‡¶®?',
                options: ['‡¶Ü‡¶Ø‡¶º‡¶ø‡¶∂‡¶æ ‡¶∞‡¶æ.', '‡¶´‡¶æ‡¶§‡¶ø‡¶Æ‡¶æ ‡¶∞‡¶æ.', '‡¶ñ‡¶æ‡¶¶‡¶ø‡¶ú‡¶æ ‡¶∞‡¶æ.', '‡¶π‡¶æ‡¶´‡¶∏‡¶æ ‡¶∞‡¶æ.'],
                correctAnswer: 2
            },
            {
                id: 5,
                type: 'mcq',
                question: '‡¶π‡¶ø‡¶ú‡¶∞‡¶§‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßÄ ‡¶ï‡ßá ‡¶õ‡¶ø‡¶≤‡ßá‡¶®?',
                options: ['‡¶â‡¶Æ‡¶∞ ‡¶∞‡¶æ.', '‡¶Ü‡¶¨‡ßÅ ‡¶¨‡¶ï‡¶∞ ‡¶∞‡¶æ.', '‡¶â‡¶∏‡¶Æ‡¶æ‡¶® ‡¶∞‡¶æ.', '‡¶Ü‡¶≤‡ßÄ ‡¶∞‡¶æ.'],
                correctAnswer: 1
            },
            {
                id: 6,
                type: 'mcq',
                question: '‡¶¨‡¶¶‡¶∞ ‡¶Ø‡ßÅ‡¶¶‡ßç‡¶ß ‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶≤‡ßá ‡¶∏‡¶Ç‡¶ò‡¶ü‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º?',
                options: ['‡ß® ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ß© ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ß™ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ß´ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ'],
                correctAnswer: 0
            },
            {
                id: 7,
                type: 'mcq',
                question: '‡¶â‡¶π‡ßÅ‡¶¶ ‡¶Ø‡ßÅ‡¶¶‡ßç‡¶ß‡ßá ‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø ‡¶¶‡¶æ‡¶Å‡¶§ ‡¶∂‡¶π‡ßÄ‡¶¶ ‡¶π‡¶Ø‡¶º?',
                options: ['‡ßß‡¶ü‡¶ø', '‡ß®‡¶ü‡¶ø', '‡ß©‡¶ü‡¶ø', '‡ß™‡¶ü‡¶ø'],
                correctAnswer: 1
            },
            {
                id: 8,
                type: 'mcq',
                question: '‡¶Æ‡¶ï‡ßç‡¶ï‡¶æ ‡¶¨‡¶ø‡¶ú‡¶Ø‡¶º ‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶≤‡ßá ‡¶π‡¶Ø‡¶º?',
                options: ['‡ß¨ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ß≠ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ßÆ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ', '‡ßØ ‡¶π‡¶ø‡¶ú‡¶∞‡ßÄ'],
                correctAnswer: 2
            },
            {
                id: 9,
                type: 'short',
                question: '‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§'
            },
            {
                id: 10,
                type: 'short',
                question: '‡¶Æ‡¶ø\'‡¶∞‡¶æ‡¶ú ‡¶ï‡ßã‡¶® ‡¶∂‡¶π‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Ç‡¶ò‡¶ü‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡¶ø‡¶≤?'
            }
        ];

        // State
        let state = {
            view: 'start',
            participant: { name: '', phone: '' },
            answers: {},
            currentQuestion: 0,
            timeLeft: 60 * 60,
            startTime: null,
            submissions: [],
            timerInterval: null,
            loading: false,
            autoSaveTimeout: null,
            onlineStorageAvailable: false
        };

        // Check if online storage is available
        function checkOnlineStorage() {
            state.onlineStorageAvailable = typeof window.storage !== 'undefined';
            return state.onlineStorageAvailable;
        }

        // Online Storage functions
        async function saveSubmissionOnline(submission) {
            try {
                const key = 'submission_' + submission.timestamp + '_' + submission.phone.replace(/\D/g, '').slice(-4);
                const result = await window.storage.set(key, JSON.stringify(submission), true);
                
                if (result) {
                    console.log('‚úì ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                    return true;
                }
                return false;
            } catch (error) {
                console.error('‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', error);
                return false;
            }
        }

        async function loadSubmissionsOnline() {
            try {
                const result = await window.storage.list('submission_', true);
                
                if (result && result.keys) {
                    const submissions = [];
                    
                    for (const key of result.keys) {
                        try {
                            const data = await window.storage.get(key, true);
                            if (data && data.value) {
                                submissions.push(JSON.parse(data.value));
                            }
                        } catch (e) {
                            console.error('‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:', key);
                        }
                    }
                    
                    return submissions.sort((a, b) => b.timestamp - a.timestamp);
                }
                return [];
            } catch (error) {
                console.error('‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', error);
                return [];
            }
        }

        // Local Storage (backup)
        async function saveSubmissionLocal(submission) {
            try {
                const allSubs = JSON.parse(localStorage.getItem('sirat_subs') || '[]');
                allSubs.push(submission);
                localStorage.setItem('sirat_subs', JSON.stringify(allSubs));
                return true;
            } catch (error) {
                console.error('‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', error);
                return false;
            }
        }

        async function loadSubmissionsLocal() {
            try {
                return JSON.parse(localStorage.getItem('sirat_subs') || '[]');
            } catch (error) {
                console.error('‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', error);
                return [];
            }
        }

        // Combined save (both online and local)
        async function saveSubmission(submission) {
            let onlineSaved = false;
            let localSaved = false;

            // Try online storage first
            if (checkOnlineStorage()) {
                onlineSaved = await saveSubmissionOnline(submission);
            }

            // Always save locally as backup
            localSaved = await saveSubmissionLocal(submission);

            return onlineSaved || localSaved;
        }

        // Combined load (prefer online, fallback to local)
        async function loadSubmissions() {
            let submissions = [];

            // Try online first
            if (checkOnlineStorage()) {
                submissions = await loadSubmissionsOnline();
            }

            // If no online data, load from local
            if (submissions.length === 0) {
                submissions = await loadSubmissionsLocal();
            }

            state.submissions = submissions;
            return submissions;
        }

        // Auto-save functionality
        function autoSave() {
            if (state.view === 'quiz') {
                const progressData = {
                    participant: state.participant,
                    answers: state.answers,
                    currentQuestion: state.currentQuestion,
                    timeLeft: state.timeLeft,
                    startTime: state.startTime
                };
                
                try {
                    localStorage.setItem('quiz_progress', JSON.stringify(progressData));
                    showAutoSaveIndicator('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§', false);
                } catch (e) {
                    console.log('Auto-save failed');
                    showAutoSaveIndicator('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', true);
                }
            }
        }

        function showAutoSaveIndicator(message, isError = false) {
            const indicator = document.getElementById('autoSaveIndicator');
            if (indicator) {
                indicator.textContent = isError ? '‚úó ' + message : '‚úì ' + message;
                indicator.classList.toggle('error', isError);
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('quiz_progress');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (confirm('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                        state.participant = data.participant;
                        state.answers = data.answers;
                        state.currentQuestion = data.currentQuestion;
                        state.timeLeft = data.timeLeft;
                        state.startTime = new Date(data.startTime);
                        state.view = 'quiz';
                        startTimer();
                        render();
                        return true;
                    } else {
                        localStorage.removeItem('quiz_progress');
                    }
                }
            } catch (e) {
                console.log('Could not load progress');
            }
            return false;
        }

        function clearProgress() {
            try {
                localStorage.removeItem('quiz_progress');
            } catch (e) {
                console.log('Could not clear progress');
            }
        }

        // Export functions
        function exportToCSV() {
            if (state.submissions.length === 0) {
                alert('‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø');
                return;
            }

            let csv = '‡¶®‡¶æ‡¶Æ,‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤,‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞,‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞,‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶®,‡¶∏‡¶Æ‡¶Ø‡¶º,‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ\n';
            
            state.submissions.forEach(sub => {
                csv += `"${sub.name}","${sub.phone}",${sub.mcqCorrect},${sub.mcqWrong},${sub.mcqUnanswered},"${sub.timeTaken}","${sub.submittedAt}"\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = '‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§_‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ_‡¶´‡¶≤‡¶æ‡¶´‡¶≤_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }

        function exportToExcel() {
            if (state.submissions.length === 0) {
                alert('‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø');
                return;
            }

            const data = state.submissions.map((sub, idx) => ({
                '‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï': idx + 1,
                '‡¶®‡¶æ‡¶Æ': sub.name,
                '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤': sub.phone,
                '‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞': sub.mcqCorrect,
                '‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞': sub.mcqWrong,
                '‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶®': sub.mcqUnanswered,
                '‡¶∏‡¶Æ‡¶Ø‡¶º': sub.timeTaken,
                '‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': sub.submittedAt
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Results');
            
            XLSX.writeFile(wb, '‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§_‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ_‡¶´‡¶≤‡¶æ‡¶´‡¶≤_' + new Date().toISOString().split('T')[0] + '.xlsx');
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        // Start quiz
        function startQuiz() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !phone) {
                alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®');
                return;
            }
            
            state.participant = { name, phone };
            state.startTime = new Date();
            state.view = 'quiz';
            startTimer();
            autoSave();
            render();
        }

        // Timer
        function startTimer() {
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                if (state.timeLeft <= 0) {
                    submitQuiz();
                }
                updateTimer();
                
                // Auto-save every 30 seconds
                if (state.timeLeft % 30 === 0) {
                    autoSave();
                }
            }, 1000);
        }

        function updateTimer() {
            const el = document.getElementById('timer');
            if (el) el.textContent = formatTime(state.timeLeft);
        }

        // Submit quiz
        async function submitQuiz() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            
            state.loading = true;
            render();
            
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - state.startTime) / 1000);
            
            const mcqs = QUESTIONS.filter(q => q.type === 'mcq');
            let correct = 0, wrong = 0;
            
            mcqs.forEach(q => {
                if (state.answers[q.id] !== undefined) {
                    if (state.answers[q.id] === q.correctAnswer) {
                        correct++;
                    } else {
                        wrong++;
                    }
                }
            });

            const shortAnswers = QUESTIONS
                .filter(q => q.type === 'short')
                .map(q => ({
                    question: q.question,
                    answer: state.answers[q.id] || '‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶®‡¶®‡¶ø'
                }));

            const submission = {
                name: state.participant.name,
                phone: state.participant.phone,
                mcqCorrect: correct,
                mcqWrong: wrong,
                mcqUnanswered: mcqs.length - correct - wrong,
                shortAnswers: shortAnswers,
                timeTaken: formatTime(timeTaken),
                submittedAt: new Date().toLocaleString('bn-BD'),
                timestamp: Date.now()
            };

            const saved = await saveSubmission(submission);
            
            if (saved) {
                clearProgress();
                state.loading = false;
                state.view = 'submitted';
            } else {
                state.loading = false;
                alert('‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            }
            
            render();
        }

        // Answer functions
        function selectAnswer(questionId, answerIndex) {
            state.answers[questionId] = answerIndex;
            autoSave();
            render();
        }

        function updateShortAnswer(questionId) {
            const el = document.getElementById('shortAnswer');
            if (el) {
                state.answers[questionId] = el.value;
                
                // Debounced auto-save
                if (state.autoSaveTimeout) {
                    clearTimeout(state.autoSaveTimeout);
                }
                state.autoSaveTimeout = setTimeout(() => {
                    autoSave();
                }, 1000);
            }
        }

        // Navigation
        function nextQuestion() {
            if (state.currentQuestion < QUESTIONS.length - 1) {
                state.currentQuestion++;
                autoSave();
                render();
            }
        }

        function prevQuestion() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                render();
            }
        }

        function goToStart() {
            state.view = 'start';
            state.currentQuestion = 0;
            state.answers = {};
            state.timeLeft = 60 * 60;
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            render();
        }

        async function showAdmin() {
            const pass = prompt('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:');
            if (pass === 'admin123') {
                state.view = 'admin';
                state.loading = true;
                render();
                await loadSubmissions();
                state.loading = false;
                render();
            } else {
                alert('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°');
            }
        }

        // Render functions
        function renderStart() {
            const storageStatus = checkOnlineStorage() 
                ? 'üåê ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§' 
                : 'üíæ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶Æ‡ßã‡¶°';

            return `
                <div class="container">
                    <div class="card">
                        <h1>‡¶∏‡ßÄ‡¶∞‡¶æ‡¶§‡ßÅ‡¶® ‡¶®‡¶¨‡ßÄ Ô∑∫ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ</h1>
                        <p class="subtitle">‡¶∞‡¶æ‡¶∏‡ßÇ‡¶≤‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π Ô∑∫ ‡¶è‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶®‡ßÄ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ</p>
                        
                        <div class="sync-status">
                            <span>${storageStatus}</span>
                        </div>
                        
                        <div class="info-box">
                            <h3>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</h3>
                            <ul>
                                <li>üìù ‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®: ‡ßß‡ß¶‡¶ü‡¶ø (‡ßÆ‡¶ü‡¶ø MCQ + ‡ß®‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§)</li>
                                <li>‚è∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ (‡ß¨‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)</li>
                                <li>‚úÖ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶•‡¶æ‡¶Æ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</li>
                                <li>üíæ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶¨‡ßá</li>
                                <li>üåê ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá</li>
                                <li>üéØ ‡¶∏‡¶¨ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                            </ul>
                        </div>

                        <div class="form-group">
                            <label>üë§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                            <input type="text" id="name" placeholder="‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                        </div>

                        <div class="form-group">
                            <label>üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label>
                            <input type="tel" id="phone" placeholder="‡ß¶‡ßßXXXXXXXXX">
                        </div>

                        <button class="btn btn-primary" onclick="startQuiz()">
                            ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶Ø‡ßã‡¶ó‡¶ø‡¶§‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>

                        <div class="admin-link">
                            <button onclick="showAdmin()">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            if (state.loading) {
                return '<div class="loading">‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
            }

            const q = QUESTIONS[state.currentQuestion];
            const progress = ((state.currentQuestion + 1) / QUESTIONS.length) * 100;

            let optionsHTML = '';
            if (q.type === 'mcq') {
                optionsHTML = q.options.map((opt, idx) => {
                    const selected = state.answers[q.id] === idx ? 'selected' : '';
                    return `
                        <button class="option ${selected}" onclick="selectAnswer(${q.id}, ${idx})">
                            <strong>${String.fromCharCode(65 + idx)}.</strong> ${opt}
                        </button>
                    `;
                }).join('');
            } else {
                const val = state.answers[q.id] || '';
                optionsHTML = `
                    <textarea id="shortAnswer" oninput="updateShortAnswer(${q.id})" 
                              rows="4" style="width:100%; padding:15px; border:2px solid #d1d5db; border-radius:10px;"
                              placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">${val}</textarea>
                `;
            }

            return `
                <div class="container">
                    <div class="timer-box">
                        <div class="timer-header">
                            <div style="color:#065f46; font-weight:bold;">
                                ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${state.currentQuestion + 1} / ${QUESTIONS.length}
                            </div>
                            <div class="timer">
                                ‚è∞ <span id="timer">${formatTime(state.timeLeft)}</span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${progress}%"></div>
                        </div>
                    </div>

                    <div class="question-card">
                        <span class="question-badge">
                            ${q.type === 'mcq' ? '‡¶¨‡¶π‡ßÅ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ' : '‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶â‡¶§‡ßç‡¶§‡¶∞'}
                        </span>
                        <div class="question-text">${q.question}</div>
                        ${optionsHTML}
                    </div>

                    <div class="nav-buttons">
                        <button class="btn btn-secondary" onclick="prevQuestion()" 
                                ${state.currentQuestion === 0 ? 'disabled' : ''}>
                            ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ
                        </button>
                        ${state.currentQuestion < QUESTIONS.length - 1 ? `
                            <button class="btn btn-primary" onclick="nextQuestion()">
                                ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®
                            </button>
                        ` : `
                            <button class="btn btn-danger" onclick="submitQuiz()">
                                ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®
                            </button>
                        `}
                    </div>
                </div>
            `;
        }

        function renderSubmitted() {
            return `
                <div class="container" style="margin-top:100px;">
                    <div class="card">
                        <div class="success-icon">‚úÖ</div>
                        <div class="success-message">
                            <h2>‡¶ú‡¶Æ‡¶æ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</h2>
                            <p>${state.participant.name}, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>
                            <p style="font-weight:bold; color:#065f46; margin-top:20px;">
                                ${checkOnlineStorage() ? 'üåê ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§' : 'üíæ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'}
                            </p>
                            <p style="font-weight:bold; color:#065f46;">
                                ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ò‡ßã‡¶∑‡¶£‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡•§
                            </p>
                            <p style="color:#6b7280; margin-top:30px;">
                                ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶Æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶æ‡¶® ‡¶¶‡¶ø‡¶®‡•§ ü§≤
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdmin() {
            if (state.loading) {
                return '<div class="loading">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
            }
            
            const storageInfo = checkOnlineStorage() 
                ? 'üåê ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá' 
                : 'üíæ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá';

            const rows = state.submissions
                .sort((a, b) => b.timestamp - a.timestamp)
                .map((sub, idx) => `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${sub.name}</td>
                        <td>${sub.phone}</td>
                        <td><span class="badge badge-green">${sub.mcqCorrect}</span></td>
                        <td><span class="badge badge-red">${sub.mcqWrong}</span></td>
                        <td><span class="badge badge-gray">${sub.mcqUnanswered}</span></td>
                        <td>${sub.timeTaken}</td>
                        <td style="font-size:12px;">${sub.submittedAt}</td>
                    </tr>
                `).join('');

            return `
                <div class="container" style="max-width:1200px;">
                    <div class="card">
                        <div class="admin-header">
                            <div>
                                <h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
                                <p style="color:#6b7280;">‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ: ${state.submissions.length}‡¶ü‡¶ø</p>
                                <p style="color:#6b7280; font-size:14px;">${storageInfo}</p>
                            </div>
                            <button class="btn btn-secondary" onclick="goToStart()">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶æ‡¶®</button>
                        </div>

                        <div class="export-buttons">
                            <button class="btn btn-success" onclick="exportToExcel()">
                                üìä Excel ‡¶è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                            <button class="btn btn-primary" onclick="exportToCSV()">
                                üìÑ CSV ‡¶è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    </div>

                    <div class="card" style="padding:0; overflow-x:auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>‡¶®‡¶æ‡¶Æ</th>
                                    <th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th>
                                    <th>‡¶∏‡¶†‡¶ø‡¶ï</th>
                                    <th>‡¶≠‡ßÅ‡¶≤</th>
                                    <th>‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶π‡ßÄ‡¶®</th>
                                    <th>‡¶∏‡¶Æ‡¶Ø‡¶º</th>
                                    <th>‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows || '<tr><td colspan="8" style="text-align:center; padding:40px; color:#9ca3af;">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡¶Æ‡¶æ ‡¶®‡ßá‡¶á</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.view === 'start') {
                app.innerHTML = renderStart();
            } else if (state.view === 'quiz') {
                app.innerHTML = renderQuiz();
            } else if (state.view === 'submitted') {
                app.innerHTML = renderSubmitted();
            } else if (state.view === 'admin') {
                app.innerHTML = renderAdmin();
            }
        }

        // Initialize
        window.onload = function() {
            // Check storage availability
            checkOnlineStorage();
            
            // Try to load saved progress
            if (!loadProgress()) {
                render();
            }
        };
    </script>
</body>
</html>
